<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <title>ヒントとコツ
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="FsCheck is a tool for testing .NET programs automatically using randomly generated test cases."/>
    <meta name="author" content="Kurt Schelfthout and contributors"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/FsCheck/ja/../content/style.css" />
    <script type="text/javascript" src="/FsCheck/ja/../content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://github.com/fscheck/FsCheck/fork">Fork me on GitHub</a></li>
        </ul>
        <h3 class="muted"><a href="/FsCheck/ja/index.html">FsCheck</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>ヒントとコツ</h1>
<h2>関数の性質</h2>
<p>FsCheck はランダムな関数値を生成できるので、関数の性質を検査できます。
例えば、次のように関数合成の結合性を検査できます:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">associativity</span> (<span class="i">x</span><span class="o">:</span><span class="i">int</span>) (<span class="i">f</span><span class="o">:</span><span class="i">int</span><span class="k">-&gt;</span><span class="i">float</span>,<span class="i">g</span><span class="o">:</span><span class="i">float</span><span class="k">-&gt;</span><span class="i">char</span>,<span class="i">h</span><span class="o">:</span><span class="i">char</span><span class="k">-&gt;</span><span class="i">int</span>) <span class="o">=</span> ((<span class="i">f</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">g</span>) <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">h</span>) <span class="i">x</span> <span class="o">=</span> (<span class="i">f</span> <span class="o">&gt;</span><span class="o">&gt;</span> (<span class="i">g</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">h</span>)) <span class="i">x</span>
<span class="i">Check</span><span class="o">.</span><span class="i">Quick</span> <span class="i">associativity</span>
</code></pre>
<table class="pre"><tr><td><pre><code>Ok, passed 100 tests.</code></pre></td></tr></table>
<p>Tree -&gt; <em>任意の型</em> を生成できます。反例が見つかった場合は、関数値が <func> として表示されます。</p>
<p>しかしながら、 FsCheck は Function 型を使用することで、より詳細に生成された関数を表示することが出来ます。
もしそれを使えば、 FsCheck は関数をシュリンクすることさえ可能です。例は以下の通りです:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">mapRec</span> (<span class="i">F</span> (_,<span class="i">f</span>)) (<span class="i">l</span><span class="o">:</span><span class="i">list</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) <span class="o">=</span>
  <span class="i">not</span> <span class="i">l</span><span class="o">.</span><span class="i">IsEmpty</span> <span class="o">==&gt;</span>
      <span class="k">lazy</span> (<span class="i">List</span><span class="o">.</span><span class="i">map</span> <span class="i">f</span> <span class="i">l</span> <span class="o">=</span> (<span class="c">(*f &lt;|*)</span> <span class="i">List</span><span class="o">.</span><span class="i">head</span> <span class="i">l</span>) <span class="o">::</span> <span class="i">List</span><span class="o">.</span><span class="i">map</span> <span class="i">f</span> (<span class="i">List</span><span class="o">.</span><span class="i">tail</span> <span class="i">l</span>))
<span class="i">Check</span><span class="o">.</span><span class="i">Quick</span> <span class="i">mapRec</span>
</code></pre>
<table class="pre"><tr><td><pre><code>Falsifiable, after 2 tests (2 shrinks) (StdGen (2070888715,296355073)):
Original:
{ 0-&gt;3; 1-&gt;0 }
[1; 0]
Shrunk:
{ 0-&gt;0; 1-&gt;0 }
[1]</code></pre></td></tr></table>
<p><code>Function&lt;'a,'b&gt;</code> 型は呼ばれていたすべての引数、および生成した結果の写像を記録します。
性質では、例のようにパターンマッチによって実際の関数を抽出することが出来ます。
Function は関数を出力し、また関数をシュリンクするために使用されます。</p>
<h2>カスタムジェネレータを使うため forAll の代わりにパターンマッチを使用する</h2>
<p>既存の型の普通の範囲の値の部分集合、例えばすべての偶数といったものを生成するジェネレータを定義するために、
1ケースだけの共用体を定義して新しい型用のジェネレータを登録すれば、性質をより読みやすくするでしょう:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">EvenInt</span> <span class="o">=</span> <span class="i">EvenInt</span> <span class="k">of</span> <span class="i">int</span> <span class="k">with</span>
  <span class="k">static</span> <span class="k">member</span> <span class="i">op_Explicit</span>(<span class="i">EvenInt</span> <span class="i">i</span>) <span class="o">=</span> <span class="i">i</span>

<span class="k">type</span> <span class="i">ArbitraryModifiers</span> <span class="o">=</span>
    <span class="k">static</span> <span class="k">member</span> <span class="i">EvenInt</span>() <span class="o">=</span> 
        <span class="i">Arb</span><span class="o">.</span><span class="i">from</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span> 
        <span class="o">|&gt;</span> <span class="i">Arb</span><span class="o">.</span><span class="i">filter</span> (<span class="k">fun</span> <span class="i">i</span> <span class="k">-&gt;</span> <span class="i">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span> <span class="n">0</span>) 
        <span class="o">|&gt;</span> <span class="i">Arb</span><span class="o">.</span><span class="i">convert</span> <span class="i">EvenInt</span> <span class="i">int</span>
        
<span class="i">Arb</span><span class="o">.</span><span class="i">register</span><span class="o">&lt;</span><span class="i">ArbitraryModifiers</span><span class="o">&gt;</span>()

<span class="k">let</span> <span class="i">``generated even ints should be even``</span> (<span class="i">EvenInt</span> <span class="i">i</span>) <span class="o">=</span> <span class="i">i</span> <span class="o">%</span> <span class="n">2</span> <span class="o">=</span> <span class="n">0</span>
<span class="i">Check</span><span class="o">.</span><span class="i">Quick</span> <span class="i">``generated even ints should be even``</span>
</code></pre>
<table class="pre"><tr><td><pre><code>Ok, passed 100 tests.</code></pre></td></tr></table>
<p>同様に、今やカスタムシュリンク関数を定義することも簡単です。</p>
<p>FsCheck は <code>NonNegativeInt</code> 、 <code>PositiveInt</code> 、 <code>StringWithoutNullChars</code> などでもこのパターンを使っています。
<code>Arb.Default</code> 型にあるデフォルトの Arbitrary インスタンスを参照してください。</p>
<p>また、この手のジェネレータにとって、 <code>Arb.filter</code> 、 <code>Arb.convert</code> そして <code>Arb.mapFilter</code> 関数は役に立つでしょう。</p>
<h2>等式の左辺と右辺を出力する等価比較</h2>
<p>性質は一般に等価性をチェックします。テストケースが失敗した場合、FsCheck は反例を出力しますが、
特に最初に生成された引数でいくつかの複雑な計算を行う場合は、比較の左辺と右辺も出力すると便利なことがあります。
これを簡単にするために、独自のラベル表示等価コンビネータを定義できます:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> (<span class="o">.</span><span class="o">=.</span>) <span class="i">left</span> <span class="i">right</span> <span class="o">=</span> <span class="i">left</span> <span class="o">=</span> <span class="i">right</span> <span class="o">|@</span> <span class="i">sprintf</span> <span class="s">&quot;%A = %A&quot;</span> <span class="i">left</span> <span class="i">right</span>

<span class="k">let</span> <span class="i">testCompare</span> (<span class="i">i</span><span class="o">:</span><span class="i">int</span>) (<span class="i">j</span><span class="o">:</span><span class="i">int</span>) <span class="o">=</span> <span class="n">2</span><span class="o">*</span><span class="i">i</span><span class="o">+</span><span class="n">1</span>  <span class="o">.</span><span class="o">=.</span> <span class="n">2</span><span class="o">*</span><span class="i">j</span><span class="o">-</span><span class="n">1</span>
<span class="i">Check</span><span class="o">.</span><span class="i">Quick</span> <span class="i">testCompare</span>
</code></pre>
<table class="pre"><tr><td><pre><code>Falsifiable, after 1 test (2 shrinks) (StdGen (2072350186,296355073)):
Label of failing property: 3 = -1
Original:
2
1
Shrunk:
1
0</code></pre></td></tr></table>
<p>もちろん、あなたがよく使用する任意の演算子や関数に対してこれを行うことが出来ます。</p>
<h2>FsCheck のテストを実行するためのいくつかの方法</h2>
<ul>
<li>
あなたのプロジェクトにある fsx ファイルに性質やジェネレータを追加する。実行するのは簡単で、ctrl-a を押してから alt-enter を押すだけで、
結果が F# Interactive に表示されます。ソリューションに組み込まれている dll を参照するときは注意してください。 F# Interactive は
セッションの残りの間はずっとそれらをロックし、セッションを終了するまでビルドすることが出来ません。1つの解決策は、dll の代わりにソースファイルを
(ソリューションに)含めることですが、それは処理を遅くします。小規模なプロジェクトに有用です。デバッグするのは難しいですが。
</li>
<li>
別のコンソールアプリケーションを作成する。デバッグは簡単ですし、アセンブリに迷惑なロックを行いません。テストのために FsCheck のみを使用し、
性質が複数のアセンブリをまたぐような場合は、最良の選択肢です。
</li>
<li>
別のユニットテストフレームワークを使用する。 FsCheck とユニットテストの手法が混在し(いくつかのものはユニットテストを使ってチェックした方が簡単ですし、
逆もまた然りです)、グラフィカルランナーを好む場合に便利です。あなたが使用しているユニットテストフレームワーク次第では、無料で Visual Studio と
上手く統合できるでしょう。このシナリオで FsCheck をカスタマイズする方法は、上記を参照してください。
</li>
</ul>


        </div>
        <div class="span3">
          <img src="/FsCheck/ja/../img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">FsCheck</li>
            <li><a href="/FsCheck/ja/index.html">ホームページ</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.com/packages/FsCheck">Get Library via NuGet</a></li>
            <li><a href="http://github.com/fscheck/FsCheck">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fscheck/FsCheck/blob/master/License.txt">License</a></li>
            <li><a href="http://github.com/fscheck/FsCheck/blob/master/FsCheck Release Notes.md">Release Notes</a></li>
            
            <li class="nav-header">はじめよう</li>
            <li><a href="/FsCheck/ja/QuickStart.html">クイックスタート</a></li>

            <li class="nav-header">ドキュメント</li>
            <li>
              <a href="/FsCheck/ja/Properties.html">性質</a>
            </li>
            <li>
              <a href="/FsCheck/ja/TestData.html">テストデータの生成</a>
            </li>
            <li>
              <a href="/FsCheck/ja/StatefulTesting.html">モデルベースのテスト</a>
            </li>
            <li>
              <a href="/FsCheck/ja/RunningTests.html">テストの実行</a>
            </li>
            <li>
              <a href="/FsCheck/ja/TipsAndTricks.html">ヒントとコツ</a>
            </li>
            <li><a href="/FsCheck/ja/../reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fscheck/FsCheck">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/>
    </a>
  </body>
  </html>
